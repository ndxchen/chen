## 小程序面试题

### 说说你对微信小程序的理解? 优缺点?

微信小程序是腾讯公司推出的一种基于微信平台的应用形态，允许开发者构建运行在微信内、功能丰富的轻量化应用。用户无需离开微信环境或下载安装即可直接使用这些小程序，实现了“即搜即用、即用即走”的便捷体验。以下是微信小程序的几个主要优缺点：

优点：
1. **轻便易用**：无需下载安装，节省手机存储空间，用户通过微信搜索或扫描二维码即可快速启动小程序。
2. **低门槛访问**：借助微信庞大的用户基础，小程序拥有广泛的潜在用户群体，能够快速触达和服务用户。
3. **快速加载**：小程序体积小，通常加载速度较快，提供接近原生App的用户体验。
4. **开发成本相对较低**：相较于原生App，小程序的开发周期和成本一般更低，尤其适合中小企业和初创团队试水市场。
5. **深度集成微信生态**：可以调用微信提供的丰富API，实现支付、社交分享、账号体系等功能，提升服务效率。

缺点：
1. **功能受限**：早期版本小程序有大小限制（如曾经限制为单个包不超过2MB），虽然这一限制可能已经有所放宽，但相对于独立App，小程序在功能复杂度和资源使用上仍有局限性。
2. **技术框架不稳定**：历史上曾出现过技术框架更新频繁，开发者需要不断适应变化，增加了开发和维护成本。
3. **开放性不足**：小程序不允许跳转外部链接，一定程度上限制了内容和服务的拓展性，同时缺乏自主推广渠道，如不能直接分享至朋友圈。
4. **审核机制严格**：所有小程序上线前必须经过微信的审核流程，这可能导致产品迭代速度受制于审核周期。
5. **依赖微信平台**：小程序的发展和命运高度依赖微信平台的政策调整和技术支持，没有完全独立运营的可能性，这也意味着在数据安全、隐私保护等方面受制于微信规则。

随着时间推移和技术更新，部分缺点可能得到了改善，但总体而言，微信小程序作为轻量级解决方案，在特定场景下具有显著优势，但也需面对因平台特性带来的挑战。

### 说说微信小程序的生命周期函数有哪些?

微信小程序的生命周期函数分为两类：应用生命周期函数和页面生命周期函数。

#### 应用生命周期函数（在 app.js 文件中定义）：

1. **onLaunch**: 在小程序初始化完成并准备接收用户请求时触发，全局只触发一次。常用于全局数据初始化、用户登录状态检查等工作。

#### 页面生命周期函数（在页面对应的 .js 文件中定义）：

1. **onLoad**: 页面加载时触发，一个页面只会调用一次，可在此获取页面路径参数及选项数据。
2. **onReady**: 页面初次渲染完成时触发，此时所有页面样式已布局完成，DOM 结构以及数据绑定都已经完成，可以进行与界面相关的操作。
3. **onShow**: 每次页面显示时触发，包括从其他页面返回、从后台重新进入前台等情况。
4. **onHide**: 页面从前台进入后台（如点击左上角关闭按钮或者 navigateTo 到其他页面）时触发，用于执行页面隐藏时的清理工作。
5. **onUnload**: 页面被卸载时触发，如 redirectTo 或 navigateBack 导航离开页面时调用，用于页面彻底销毁前的清理工作。

#### 其他相关函数：

* **onPullDownRefresh**: 用户下拉屏幕进行刷新时触发。
* **onReachBottom**: 页面滚动到底部时触发，适用于无限滚动加载更多内容的情况。
* **onShareAppMessage**: 自定义转发分享卡片内容时触发，用于配置分享给好友或群聊的相关信息。

以上生命周期函数构成了微信小程序的基本结构框架，开发者可以根据不同阶段执行相应的业务逻辑和数据处理。随着微信小程序平台的迭代，可能会有新增或调整的生命周期函数，请以最新的官方文档为准。

### 说说微信小程序的登录流程?

微信小程序的登录流程主要包括以下几个步骤：

1. **用户授权登录**:
   - 用户在小程序内部点击登录按钮后，小程序前端调用微信 SDK 提供的 `wx.login` 方法。
   - 此方法会弹出授权提示框让用户确认是否授权登录，用户同意后，微信会返回一个临时的 `code` 给小程序。

2. **前端向后端传输code**:
   - 小程序前端收到 `code` 后，将其通过 HTTPS 请求发送给开发者服务器。

3. **服务器端交换用户唯一标识**:
   - 开发者服务器接收到 `code` 后，调用微信服务器提供的接口（通常是 `https://api.weixin.qq.com/sns/jscode2session` ），传递 `code` 以及其他必要的参数（比如 AppID、AppSecret 等）。
   - 微信服务器验证 `code` 合法性并通过后，会返回 JSON 数据，其中包括用户的 `openid` （微信中的唯一用户标识，同一小程序下唯一）、 `session_key` （用于后续的数据加密解密）以及在满足一定条件下可能返回的 `unionid` （当用户在同一主体下的多个小程序或公众号之间有授权时，表示用户唯一身份的标识）。

4. **生成业务登录态**:
   - 开发者服务器根据微信返回的用户标识（主要是 `openid` ）生成自己的业务登录态，例如创建一个 `token` 或 `sessionId` 。
   - 这个 `token` 或 `sessionId` 不直接包含敏感信息，而是用于在后续的业务交互中验证用户身份和维持登录状态。

5. **保存登录态到客户端**:
   - 开发者服务器将生成的业务登录态（如 `token` ）返回给小程序前端。
   - 前端接收到登录态后，使用微信小程序提供的 `wx.setStorageSync` 或 `wx.setStorage` 方法将登录态存储在本地，以便在用户后续使用小程序时自动保持登录状态。

6. **用户信息获取**（可选）:
   - 如果需要获取更详细的用户信息，小程序还可以进一步调用微信的 `getUserInfo` 接口获取用户授权后的个人信息，此过程同样需要用户授权，并且服务器端可以利用 `session_key` 对接收到的用户信息进行解密。

总之，整个登录流程的核心在于通过微信平台提供的接口安全地获取并管理用户的登录状态，确保用户能够在小程序内顺畅地进行授权登录及后续的个性化服务。

### 说说微信小程序中路由跳转的方式有哪些? 区别?

微信小程序提供了多种页面跳转方式来满足不同的应用场景，这些路由跳转方式包括但不限于：

1. **wx.navigateTo()**
   - 功能：保留当前页面，跳转到应用内的某个页面，新页面会被压入页面栈中，形成后进先出（LIFO）的关系。
   - 示例：

     

```javascript
     wx.navigateTo({
         url: 'path/to/page'
     });
```

   - 返回：用户可以通过点击页面左上角的返回按钮返回上一页。

2. **wx.redirectTo()**
   - 功能：关闭当前页面，跳转到应用内的另一个页面，不保留当前页面，新页面成为新的栈顶页面。
   - 示例：

     

```javascript
     wx.redirectTo({
         url: 'path/to/page'
     });
```

   - 返回：由于关闭了当前页面，因此用户不能通过默认的返回按钮返回上一个页面，若需要则需要在目标页面自定义返回逻辑。

3. **wx.switchTab()**
   - 功能：主要用于跳转至小程序底部 TabBar 中已定义的页面，同时会关闭其他所有非 TabBar 页面。
   - 示例：

     

```javascript
     wx.switchTab({
         url: '/pages/tabBarPage/tabBarPage'
     });
```

   - 返回：通常情况下，从 TabBar 页面再次调用 `wx.switchTab()` 到同一个 Tab 页时不执行跳转，因为已经是当前页面。

4. **wx.reLaunch()**
   - 功能：关闭所有页面，打开到应用内的某个页面，这将会清空页面栈，重新启动一个新的页面栈。
   - 示例：

     

```javascript
     wx.reLaunch({
         url: 'path/to/page'
     });
```

   - 返回：无法通过简单的返回操作回到原来的页面集合，因为它们已经被清除。

5. **wx.navigateBack()**
   - 功能：返回上一页面或者指定层级的页面。在当前页面栈中返回一定的层数，如果没有传入delta，则默认返回上一层级。
   - 示例：

     

```javascript
     wx.navigateBack({
         delta: 1 // 返回上一级页面
     });
```

   - 返回：返回到历史记录中的页面，用户可见返回动画，适用于多层级页面间的逐层返回。

每种方式都有其适用场景，根据实际需求选择合适的方式来组织页面之间的跳转逻辑，如：

* 当需要用户在访问新页面的同时还能方便地返回原页面时，使用 `wx.navigateTo`。
* 当需要强制跳转到新的业务流程起点而忽略之前的操作时，使用 `wx.redirectTo`。
* 当需要快速切换至主界面（TabBar页面）时，使用 `wx.switchTab`。
* 当需要彻底刷新整个页面栈并跳转到全新的首页时，使用 `wx.reLaunch`。
* 在需要返回先前浏览过的页面时，使用 `wx.navigateBack`。

### 说说微信小程序的发布流程?

微信小程序的发布流程包含一系列步骤，确保小程序合法合规并且功能完善之后才能上线供用户使用。以下是微信小程序发布的主要流程概述：

1. **账号注册与认证**
   - 注册一个微信公众号，并关联小程序账号。
   - 对小程序账号进行实名认证，如果是企业主体，可能需要支付认证费用。

2. **基本信息设置**
   - 在微信公众平台的小程序管理后台，填写小程序的基本信息，如名称、介绍、服务类目、图标、客服联系方式等。
   - 根据小程序提供的服务选择对应的服务类目，并上传相关资质证明材料进行审核。

3. **开发阶段**
   - 使用微信开发者工具进行小程序的开发，包括编写代码、设计界面、实现功能等。
   - 在开发者工具内进行代码编辑、编译、预览和真机调试，确保小程序无误且达到预期效果。

4. **版本管理与提交**
   - 在开发者工具中将编写好的小程序代码上传到微信公众平台后台。
   - 在小程序管理后台的“版本管理”模块查看上传的开发版本，提交该版本进行审核。

5. **审核过程**
   - 提交审核前确保小程序符合微信平台的审核规范和政策。
   - 审核期间，微信官方会对小程序的内容、功能、安全性等方面进行全面审查。
   - 审核周期视具体情况而定，一般在几小时到几天之间。

6. **审核结果与发布**
   - 审核通过后，会在版本管理中出现“发布”按钮。
   - 点击“发布”按钮，可以选择全量发布或灰度发布。
   - 全量发布意味着立即推送给所有用户最新版本的小程序。
   - 灰度发布则可以选择特定比例的用户群进行新版本的试运行，便于收集反馈并逐步调整优化。

7. **上线后的运维**
   - 发布成功后，用户就可以在微信中搜索或扫描二维码找到并使用小程序。
   - 开发者持续关注用户反馈和小程序性能，如有必要可进行迭代更新。

总结一下，微信小程序发布的完整流程涵盖了从账号注册、信息配置、开发测试、版本提交审核到最终上线发布的一系列环节，确保小程序的质量和合规性。

### 说说微信小程序的支付流程?

微信小程序的支付流程涉及用户下单、服务端与微信支付系统交互以及支付结果通知等多个环节。以下是微信小程序内完成支付的一般流程概览：

1. **用户下单**
   - 用户在小程序内选择商品或服务，填写相关信息（如收货地址、备注等）并确认订单详情后，点击“去支付”或“立即支付”按钮。

2. **生成预支付订单**
   - 小程序前端将订单信息（商品ID、数量、总价等）以及用户唯一标识（openid）发送给小程序后端服务器。
   - 后端服务器接收到这些信息后，会生成预支付订单，包括订单号、总金额、商品描述等，并调用微信支付API接口发起预支付请求。

3. **调用微信支付接口**
   - 后端服务器调用微信支付接口，传入预支付订单信息，并采用一定的签名算法确保请求的安全性。
   - 微信支付系统会返回一个预支付交易会话标识（prepay_id）和其他必要参数。

4. **唤起支付界面**
   - 小程序前端通过调用 `wx.requestPayment` 方法，使用后端返回的预支付交易会话标识和其他参数来发起支付请求。
   - 用户在小程序内看到支付界面，输入密码或指纹等进行身份验证和支付确认。

5. **支付确认与扣款**
   - 用户完成支付验证后，微信支付系统会进行扣款操作，并实时将支付结果反馈给微信支付服务器。

6. **支付结果通知**
   - 微信支付服务器会通过异步回调接口，向小程序后端服务器发送支付结果通知（包括成功、失败等各种状态）。
   - 后端服务器对接收到的通知进行验签，确认支付结果有效后，更新订单状态。

7. **前端展示支付结果**
   - 后端服务器将支付结果告知小程序前端，前端根据结果提示用户支付成功或失败，并进行相应的页面跳转或业务处理。

8. **商户后台处理**
   - 商户后台同步收到支付成功的通知后，进行后续的订单处理工作，如发货、更新库存、记录用户消费行为等。

在整个过程中，保证数据的安全传输、正确处理支付回调通知以及及时更新订单状态是非常关键的环节。同时，微信小程序在使用支付功能前，还需要完成微信支付商户号的申请和绑定，确保小程序具备线上收款的能力。

### 说说微信小程序的实现原理?

微信小程序的实现原理结合了浏览器环境、定制化的编程语言和框架以及与微信客户端深度集成的特性，旨在构建一种轻量级的应用形态，为用户提供接近原生APP的体验。以下是一些核心原理和技术要点：

1. **前端技术栈**：
   - **WXML** (WeiXin Markup Language)：微信小程序的标记语言，类似于HTML，用于构建用户界面结构。
   - **WXSS** (WeiXin Style Sheets)：微信小程序的样式表语言，类似CSS，定义组件和页面的样式。
   - **JavaScript**：小程序的核心逻辑部分使用JavaScript编写，但微信对其进行了扩展，提供了微信特有的API和框架，如Component、Page等。

2. **运行环境**：
   - **渲染层（Webview）**：小程序的用户界面渲染在一个基于WebKit或其他优化过的浏览器内核环境中，每个小程序页面对应一个独立的WebView线程，负责界面渲染。
   - **逻辑层（AppService）**：小程序的业务逻辑和数据处理则运行在独立的JsCore线程中，这是一个没有浏览器环境的纯JavaScript运行环境，用于增强安全性并提升性能。

3. **通信机制**：
   - **WeixinJSBridge**：逻辑层和渲染层之间通过系统层级的WeixinJSBridge进行通信，实现数据的双向同步。逻辑层可以修改数据模型，进而自动触发视图层的更新，同时视图层也可以通过事件机制传递用户交互信息给逻辑层进行处理。

4. **API调用**：
   - 微信小程序允许开发者调用微信客户端提供的丰富API，包括但不限于网络请求、数据缓存、位置服务、媒体文件操作、设备能力访问（如蓝牙、NFC等）、微信账号体系下的用户授权登录等功能。

5. **框架结构**：
   - 微信小程序遵循MVVM（Model-View-ViewModel）模式，通过数据驱动视图更新，提高开发效率。
   - 它采用单页面应用程序（SPA）的设计理念，尽管所有页面都在同一个主容器中加载，但实际上各个页面的渲染逻辑和生命周期是隔离的。

6. **性能优化**：
   - 微信小程序为了提高用户体验，做了许多性能优化措施，比如资源预加载、局部刷新而非整页重载、离线包加载等。

综上所述，微信小程序通过特定的语言和框架，以及与微信客户端紧密集成的方式，实现在无需下载安装的情况下，即可为用户提供流畅且丰富的应用体验。

### 说说提高微信小程序的应用速度的手段有哪些?

提高微信小程序应用速度可以从多个方面进行优化，下面列举了一些有效的手段：

1. **代码优化与压缩**：
   - 勾选微信开发者工具中的代码压缩选项，在上传代码时自动压缩，减少代码体积。
   - 删除未使用的代码和资源，避免引入不必要的第三方库或插件，减小小程序包大小。

2. **分包加载与按需加载**：
   - 根据用户访问频率和页面重要性，将小程序划分为主包和子包，主包包含常用页面，子包按需加载，减少初始加载时间。
   - 使用分包预加载技术，提前下载子包，减少用户点击子包页面时的等待时间。

3. **资源优化**：
   - 图片优化：使用压缩工具压缩图片，选用合适的图片格式（如webp），减少图片大小而不影响视觉质量，同时支持懒加载和预加载策略。
   - 静态资源CDN加速：将静态资源（如图片、CSS、JavaScript）托管在CDN上，通过内容分发网络减少网络延迟。

4. **HTTP请求优化**：
   - 减少HTTP请求次数：合并请求，利用请求池或批量请求技术。
   - 缓存策略：合理使用缓存，对于不变或变化较少的数据，可以设置长期缓存，避免频繁重复请求。

5. **数据预取与用户行为预测**：
   - 预加载数据：根据用户行为分析，预测用户下一步操作，提前加载相关页面或数据，如在视频列表页预先加载下一个可能播放的视频数据。
   - 用户交互优化：对用户高频交互区域进行特殊优化，如滚动加载列表、动态加载更多内容等。

6. **组件化与模块化**：
   - 将UI组件和业务逻辑模块化，提高代码复用率，减少整体代码体积，同时也有利于开发和维护。

7. **页面加载优化**：
   - 优化首屏加载速度，优先加载关键渲染路径所需的资源，使页面尽快呈现主要内容。
   - 使用骨架屏或者Loading动画，掩盖加载过程，提升用户感知速度。

8. **性能监控与调优**：
   - 使用微信小程序提供的性能监控工具，定位瓶颈，针对具体问题进行针对性优化。

通过上述一系列手段，可以从代码、资源、网络请求、用户交互等多个层面全面优化微信小程序的加载速度和运行效率，从而提高用户体验。
